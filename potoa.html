<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script>
        async function btn() {
            const str = document.getElementById('data').value
            const arr = str.trim().split(/\r?\n/);
            arr.forEach((element, index) => {
                arr[index] = element.slice(0, element.length - 1);
            });
            const flag = arr[arr.length - 1] === "======";
            const len = arr.length - (flag ? 1 : 0);
            let data = new Uint8Array(len * 2)
            document.getElementById('text').innerHTML = ""
            let all_data = JSON.parse("");
            await fetch("map.json")
                .then(response => {
                    if (!response.ok) {
                        return Promise.reject(response);
                    }
                    return response;
                }
                )
                .then(a => a.json())
                .then(a => all_data = a);
            for (var i = 0; i < len; i++) {
                data[i * 2] = all_data[arr[i]] >> 8;
                data[i * 2 + 1] = all_data[arr[i]] & 0x0F;
            }
            if (flag) data = data.slice(0, len * 2 - 1);
            const decoder = new TextDecoder();
            const view = decoder.decode(data);
            document.getElementById('text').innerHTML += view;
        }
    </script>
</head>

<body>

    <h2>诗歌鉴赏</h2>
    <textarea style="display:block;width:100%" id="data" rows="20"></textarea>
    <button id="btn">Try it</button>
    <script>
        document.getElementById("btn").onclick = async () => {
            await btn();
        }
    </script>
    <div id="text"></div>

</body>

</html>
